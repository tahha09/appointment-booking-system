<main class="patient-profile">
  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="patient-profile__form">
    <section class="patient-profile__header">
      <div class="patient-profile__avatar">
        <ng-container *ngIf="profileImage; else initialsAvatar">
          <img
            [src]="profileImage"
            alt="Patient avatar"
            class="patient-profile__avatar-img"
          />
        </ng-container>
        <ng-template #initialsAvatar>
          <span class="patient-profile__avatar-initials">
            {{ getInitials(displayName || 'P') }}
          </span>
        </ng-template>
      </div>
      <div class="patient-profile__header-info">
        <h1>{{ displayName }}</h1>
        <p class="patient-profile__role">Patient</p>
        <p class="patient-profile__subtitle">
          Manage your personal details and health information.
        </p>
      </div>
    </section>

    <section class="patient-profile__content">
      <div class="patient-profile__card">
        <h2>Personal Information</h2>
        <div class="patient-profile__grid">
          <div class="patient-profile__field">
            <span class="patient-profile__label">Full name</span>
            <input
              type="text"
              formControlName="fullName"
              class="patient-profile__input"
              placeholder="Your full name"
            />
          </div>
          <div class="patient-profile__field">
            <span class="patient-profile__label">Email</span>
            <input
              type="email"
              formControlName="email"
              class="patient-profile__input patient-profile__input--readonly"
              placeholder="you@example.com"
              readonly
            />
          </div>
          <div class="patient-profile__field">
            <span class="patient-profile__label">Phone</span>
            <input
              type="text"
              formControlName="phone"
              class="patient-profile__input"
              placeholder="+1 (555) 123-4567"
            />
          </div>
          <div class="patient-profile__field">
            <span class="patient-profile__label">Date of birth</span>
            <input
              type="date"
              formControlName="dateOfBirth"
              class="patient-profile__input"
            />
          </div>
          <div class="patient-profile__field patient-profile__field--full">
            <span class="patient-profile__label">Address</span>
            <input
              type="text"
              formControlName="address"
              class="patient-profile__input"
              placeholder="Your address"
            />
          </div>
        </div>
      </div>

      <div class="patient-profile__card">
        <h2>Medical Overview</h2>
        <div class="patient-profile__grid patient-profile__grid--two">
          <div class="patient-profile__field">
            <span class="patient-profile__label">Blood type</span>
            <select formControlName="bloodType" class="patient-profile__input">
              <option value="">Select blood type</option>
              <option *ngFor="let type of bloodTypes" [value]="type">
                {{ type }}
              </option>
            </select>
          </div>

          <div class="patient-profile__field">
            <span class="patient-profile__label">Chronic conditions</span>
            <select
              class="patient-profile__input"
              (change)="onChronicSelect($event)"
            >
              <option value="">Select condition</option>
              <option *ngFor="let condition of chronicConditionOptions" [value]="condition">
                {{ condition }}
              </option>
            </select>
            <div class="patient-profile__chips" *ngIf="chronicSelected.length">
              <span
                class="patient-profile__chip"
                *ngFor="let condition of chronicSelected"
              >
                <span class="patient-profile__chip-label">{{ condition }}</span>
                <button
                  type="button"
                  class="patient-profile__chip-remove"
                  (click)="removeChronic(condition)"
                  aria-label="Remove condition"
                >
                  x
                </button>
              </span>
            </div>
          </div>

          <div class="patient-profile__field patient-profile__field--full">
            <span class="patient-profile__label">Allergies</span>
            <select
              class="patient-profile__input"
              (change)="onAllergySelect($event)"
            >
              <option value="">Select allergy</option>
              <option *ngFor="let allergy of allergyOptions" [value]="allergy">
                {{ allergy }}
              </option>
            </select>
            <div class="patient-profile__chips" *ngIf="allergySelected.length">
              <span
                class="patient-profile__chip"
                *ngFor="let allergy of allergySelected"
              >
                <span class="patient-profile__chip-label">{{ allergy }}</span>
                <button
                  type="button"
                  class="patient-profile__chip-remove"
                  (click)="removeAllergy(allergy)"
                  aria-label="Remove allergy"
                >
                  x
                </button>
              </span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="patient-profile__actions">
      <button
        type="submit"
        class="patient-profile__save-btn"
        [disabled]="form.pristine || form.invalid"
      >
        Save changes
      </button>
    </div>
  </form>
</main>
